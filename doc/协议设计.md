JSON格式，紧凑模式，无回车

字符串中不能出现回车字符

后端返回时需要先转码为UTF8（如GBK->UTF8）

## 一般格式

发包： 

```json
{
    "cmd": "",
    "id": 1,

}
```

回包：

```json
{
    "cmd": "reply",
    "id": 1,
    "success": "",
}
```

## 可能的交互

- 打开文件
- 打开一个程序
- 打开粘贴板里的内容
- 查找
- 过滤
- 事件图
- 通知有新的日志行
- 通知某一块格式分析完成
- 保存/打开工程

## js端

```js
onmessage = (ev)=>{
    const data = JSON.parse(ev.data)
    if (data.cmd === 'reply') {
        peek_promise_by_id(data.id).resolve()
    } else {
        handle_server_cmd()
        ws.sendmessage(reply)
    }
}

new Promise(resolve=>{
    ws.sendmessage()
    enqueue(resolve)
})

//使用
callBackend(xxxx).then(...)
```

## rust端

```rust
main thread {
    const data = JSON.parse(stdin.readline)
    if (data.cmd === 'reply') {
    } else {
        tx.send(data)
    }
}

thread1 {
    use notify to watch file changed
    tx.send(file changed)
}

handler thread {
    loop rx {
        handle_server_cmd() 
        stdout.write(reply)
            or
        handle_file_changed()
    }
}

format thread {
    loop rx1 {//队列长度为1
        analyze format
    }
}
```